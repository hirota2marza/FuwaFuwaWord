<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Floating Keywords MTG</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@700&family=Futura&display=swap" rel="stylesheet">
<style>
body {
  margin:0;
  height:100vh;
  background-color:#fff;
  font-family:'Noto Sans JP','Futura',sans-serif;
  overflow:hidden;
  position:relative;
}
body::before {
  content:'';
  position:absolute;
  width:100%; height:100%;
  background-image: radial-gradient(circle, rgba(180,180,180,0.8) 3px, transparent 3px);
  background-size:100px 100px;
  z-index:0;
  pointer-events:none;
}

.title {
  position:absolute;
  top:20px;
  left:50%;
  transform:translateX(-50%);
  font-weight:bold;
  color:gray;
  text-align:center;
  z-index:1; /* お題は一番下 */
  pointer-events:auto;
}

.input-container {
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  z-index:1000;
}
.keyword-input {
  font-size:1.8rem;
  font-weight:bold;
  padding:0.5rem 1rem;
  border-radius:12px;
  border:2px solid #ccc;
  box-shadow:0 8px 16px rgba(0,0,0,0.1);
  outline:none;
  width:300px;
  height:80px;
  resize:none;
  font-family:'Noto Sans JP','Futura',sans-serif;
}

.floating-group {
  position:absolute;
  font-weight:bold;
  white-space:pre-wrap;
  user-select:none;
  pointer-events:auto;
  z-index:500;
  cursor:pointer;
}

.page-button {
  position:absolute;
  bottom:20px;
  font-size:2rem;
  cursor:pointer;
  background:none;
  border:none;
  z-index:1000;
}
#prev-page { left:20px; }
#next-page { right:20px; }

.page {
  position:absolute;
  width:100%;
  height:100%;
}
</style>
</head>
<body>

<div class="page" id="page1">
  <div class="title" contenteditable="true" id="title1">お題1</div>
  <div class="input-container">
    <textarea class="keyword-input" placeholder="Type words..."></textarea>
  </div>
</div>

<div class="page" id="page2" style="display:none">
  <div class="title" contenteditable="true" id="title2">お題2</div>
  <div class="input-container">
    <textarea class="keyword-input" placeholder="Type words..."></textarea>
  </div>
</div>

<button id="prev-page" class="page-button">◀</button>
<button id="next-page" class="page-button">▶</button>

<script>
let currentPage = 1;
const pages = [document.getElementById('page1'),document.getElementById('page2')];
const nextBtn = document.getElementById('next-page');
const prevBtn = document.getElementById('prev-page');

nextBtn.addEventListener('click',()=>{
  pages[currentPage-1].style.display='none';
  currentPage = currentPage===1?2:1;
  pages[currentPage-1].style.display='block';
});
prevBtn.addEventListener('click',()=>{
  pages[currentPage-1].style.display='none';
  currentPage = currentPage===1?2:1;
  pages[currentPage-1].style.display='block';
});

const colors = [
  'rgba(255,0,0,0.8)','rgba(255,127,0,0.8)','rgba(255,255,0,0.8)',
  'rgba(127,255,0,0.8)','rgba(0,255,0,0.8)','rgba(0,255,255,0.8)',
  'rgba(0,0,255,0.8)','rgba(75,0,130,0.8)','rgba(127,0,255,0.8)','rgba(255,0,127,0.8)'
];

function initFloating(inputElem,pageElem,pageKey,titleElem,titleKey){
  const groups=[];
  function randomRange(min,max){return Math.random()*(max-min)+min;}

  // お題保存・読み込み
  const savedTitle = localStorage.getItem(titleKey);
  if(savedTitle) titleElem.textContent = savedTitle;

  function adjustTitleSize(){
    const len = titleElem.textContent.length;
    const maxFont = 120;
    const minFont = 60;
    const fontSize = Math.max(minFont,maxFont-len*2);
    titleElem.style.fontSize = fontSize + 'px';
  }
  adjustTitleSize();

  titleElem.addEventListener('input', ()=>{
    localStorage.setItem(titleKey,titleElem.textContent);
    adjustTitleSize();
  });

  // 単語保存・読み込み
  const saved=localStorage.getItem(pageKey);
  if(saved){
    saved.split('\n').forEach(text=>{if(text.trim()!=='') addGroup(text.trim());});
  }

  inputElem.addEventListener('keypress',function(e){
    if(e.key==='Enter' && !e.shiftKey && inputElem.value.trim()!==''){
      const text=inputElem.value.trim();
      addGroup(text);
      localStorage.setItem(pageKey,groups.map(g=>g.textContent).join('\n'));
      inputElem.value='';
      e.preventDefault();
    }
  });

  inputElem.addEventListener('paste', function(e){
    e.preventDefault();
    const text = (e.clipboardData || window.clipboardData).getData('text');
    document.execCommand('insertText', false, text);
  });

  function addGroup(text){
    const group=document.createElement('div');
    group.className='floating-group';
    group.textContent=text;
    group.style.fontFamily="'Noto Sans JP','Futura',sans-serif";

    let x, y, safe=false;
    while(!safe){
      x=randomRange(0,window.innerWidth-300);
      y=randomRange(0,window.innerHeight-100);
      safe=true;
      for(let w of groups){
        const dx=x-w.x;
        const dy=y-w.y;
        if(Math.sqrt(dx*dx+dy*dy)<100){safe=false; break;}
      }
    }
    group.x=x; group.y=y;

    const colorIndex=Math.floor(randomRange(0,colors.length));
    const color=colors[colorIndex];
    group.color=color;
    group.style.color=color;

    group.size=randomRange(1.8,4);
    group.style.fontSize=group.size+'rem';

    group.scale=1; group.scaleDir=Math.random()>0.5?1:-1; group.scaleSpeed=randomRange(0.0003,0.0006);
    group.vx=randomRange(-0.7,0.7); group.vy=randomRange(-0.7,0.7); // 少し速く

    group.addEventListener('click',()=>{
      group.remove();
      const remaining=groups.filter(g=>g!==group).map(g=>g.textContent).join('\n');
      localStorage.setItem(pageKey,remaining);
      groups.splice(groups.indexOf(group),1);
    });

    pageElem.appendChild(group);
    groups.push(group);
  }

  function animate(){
    for(let g of groups){
      g.x+=g.vx;
      g.y+=g.vy;

      if(g.x<0){ g.x=0; g.vx*=-1;}
      if(g.x>window.innerWidth-g.offsetWidth){ g.x=window.innerWidth-g.offsetWidth; g.vx*=-1;}
      if(g.y<0){ g.y=0; g.vy*=-1;}
      if(g.y>window.innerHeight-g.offsetHeight){ g.y=window.innerHeight-g.offsetHeight; g.vy*=-1;}

      g.scale+=g.scaleSpeed*g.scaleDir;
      if(g.scale>1.2||g.scale<0.8) g.scaleDir*=-1;

      g.style.transform=`translate(${g.x}px,${g.y}px) scale(${g.scale})`;
    }
    requestAnimationFrame(animate);
  }
  animate();
}

initFloating(document.querySelector('#page1 .keyword-input'),document.getElementById('page1'),'page1Words',document.getElementById('title1'),'page1Title');
initFloating(document.querySelector('#page2 .keyword-input'),document.getElementById('page2'),'page2Words',document.getElementById('title2'),'page2Title');
</script>
</body>
</html>
